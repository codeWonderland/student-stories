<!-- Lead Form developed by Cooper on 2016-10-18 using Champlain Lead Form Builder v2 -->
<!-- Modified by Alice Easter on 2017-06-28 -->
<!-- Templates for lead forms -->
<script type="text/template" id="cclead-6559469661-desktop-template">
    <div class="ccLead ssDesktop">
        <div class="ccLeadContent">
            <h2 class="ssHeadline">INTERESTED IN LEARNING MORE?</h2>
            <form id="cclead-6559469661">
                <p class="ssCopy">Fill out the form below and we'll send you more information and some cool stickers designed by our students.</p>
                <p class="ccLeadField ccLeadFirstName">
                    <label for="FirstName-6559469661"><span class="screenreader">First Name </span></label><input id="FirstName-6559469661" class="required ccLeadInputText" type="text" name="First Name" placeholder="First Name *" title="First Name" data-msg-required="Please enter your first name." autocomplete="given-name">
                </p>
                <p class="ccLeadField ccLeadLastName">
                    <label for="LastName-6559469661"><span class="screenreader">Last Name </span></label><input id="LastName-6559469661" class="required ccLeadInputText" type="text" name="Last Name" placeholder="Last Name *" title="Last Name" data-msg-required="Please enter your last name." autocomplete="family-name">
                </p>
                <p class="ccLeadField ccLeadEmail">
                    <label for="Email-6559469661"><span class="screenreader">Email </span></label><input id="Email-6559469661" class="required email ccLeadInputText" type="text" name="Email" placeholder="Email *" title="Email" data-msg-required="Please enter your email."  data-msg-email="Please enter a valid email address." autocomplete="email">
                </p>
                <p class="ccLeadField ccLeadAddress">
                    <label for="Address-6559469661"><span class="screenreader">Street Address *</span></label><input id="Address-6559469661" class="required ccLeadInputText" type="text" name="Street1" placeholder="Street Address *" title="Street Address" autocomplete="address-line1">
                </p>
                <p class="ccLeadField ccLeadZip">
                    <label for="Zip-6559469661"><span class="screenreader">Zip *</span></label><input id="Zip-6559469661" class="required ccLeadInputText" type="text" name="ZipCode" placeholder="Zip Code *" title="Zip Code" autocomplete="postal-code">
                </p>
                <p class="ccLeadField ccLeadStudentType">
                    <label for="StudentType-6559469661"><span class="screenreader">What type of student are you?</span></label><select id="StudentType-6559469661" class="required ccLeadInputSelect chosen-select" name="Status" data-placeholder="What type of student are you? *" title="What type of student are you? *" data-msg-required="Please select your status."><option value="">What type of student are you? *</option><option value="Prospective First Year">Prospective First Year</option><option value="Prospective Transfer">Prospective Transfer</option><option value="International">International</option><option value="Exchange">Exchange</option></select></p>
                <p class="ccLeadField ccLeadProgram">
                    <label for="Major-6559469661"><span class="screenreader">Intended Major * </span></label><select id="Major-6559469661" class="required ccLeadInputSelect chosen-select" name="Major" placeholder="What do you want to study? *" title="Intended Major" data-msg-required="Please select a major you are interested in." data-placeholder="What do you want to study? *"><option value="">What do you want to study? *</option></select></p>
                <p class="ccLeadField ccLeadEntryTerm">
                    <label for="EntryTerm-6559469661"><span class="screenreader">When do you want to start? *</span></label><select id="EntryTerm-6559469661" class="required ccLeadInputSelect chosen-select" name="EntryTerm" data-placeholder="When do you want to start? *" title="Entry Term" data-msg-required="Please select your desired entry term."><option value="">When do you want to start? *</option></select></p>
                <p class="ccLeadSubmit">
                    <input type="submit" title="Request More Information" class="ssButton" value="Submit">
                </p>
            </form>
        </div>
    </div>
</script>
<script type="text/template" id="cclead-6559469661-mobile-template">
    <div class="ccLead ccLeadMobile">
        <div class="ccLeadContent">
            <h2 class="ccLeadHeadline">Interested in Learning More?</h2><div class="ccLeadTriangle"></div>
            <form id="cclead-6559469661">
                <img class="ccLeadImage ccLeadFloatRight" src="https://c25910bbec624420dd29-8ecd558624a629ebd460298bea51b15d.ssl.cf2.rackcdn.com/champlain-college-vt-stickers.jpg" title="Champlain Student Stickers" alt="Vermont Stickers Designed by Champlain Students" /><p class="ccLeadCopy">Fill out the form below and we'll send you more information and some cool stickers designed by our students.</p>
                <p class="ccLeadField ccLeadFirstName">
                    <label for="FirstName-6559469661"><span class="screenreader">First Name </span></label><input id="FirstName-6559469661" class="required ccLeadInputText" type="text" name="First Name" placeholder="First Name *" title="First Name" data-msg-required="Please enter your first name." autocomplete="given-name">
                </p>
                <p class="ccLeadField ccLeadLastName">
                    <label for="LastName-6559469661"><span class="screenreader">Last Name </span></label><input id="LastName-6559469661" class="required ccLeadInputText" type="text" name="Last Name" placeholder="Last Name *" title="Last Name" data-msg-required="Please enter your last name." autocomplete="family-name">
                </p>
                <p class="ccLeadField ccLeadEmail">
                    <label for="Email-6559469661"><span class="screenreader">Email </span></label><input id="Email-6559469661" class="required email ccLeadInputText" type="text" name="Email" placeholder="Email *" title="Email" data-msg-required="Please enter your email."  data-msg-email="Please enter a valid email address." autocomplete="email">
                </p>
                <p class="ccLeadField ccLeadAddress">
                    <label for="Address-6559469661"><span class="screenreader">Street Address *</span></label><input id="Address-6559469661" class="required ccLeadInputText" type="text" name="Street1" placeholder="Street Address *" title="Street Address" autocomplete="address-line1">
                </p>
                <p class="ccLeadField ccLeadZip">
                    <label for="Zip-6559469661"><span class="screenreader">Zip *</span></label><input id="Zip-6559469661" class="required ccLeadInputText" type="text" name="ZipCode" placeholder="Zip Code *" title="Zip Code" autocomplete="postal-code">
                </p>
                <p class="ccLeadField ccLeadStudentType">
                    <label for="StudentType-6559469661"><span class="screenreader">What type of student are you?</span></label><select id="StudentType-6559469661" class="required ccLeadInputSelect chosen-select" name="Status" data-placeholder="What type of student are you? *" title="What type of student are you? *" data-msg-required="Please select your status."><option value="">What type of student are you? *</option><option value="Prospective First Year">Prospective First Year</option><option value="Prospective Transfer">Prospective Transfer</option><option value="International">International</option><option value="Exchange">Exchange</option></select></p>
                <p class="ccLeadField ccLeadProgram">
                    <label for="Major-6559469661"><span class="screenreader">Intended Major * </span></label><select id="Major-6559469661" class="required ccLeadInputSelect chosen-select" name="Major" placeholder="What do you want to study? *" title="Intended Major" data-msg-required="Please select a major you are interested in." data-placeholder="What do you want to study? *"><option value="">What do you want to study? *</option></select></p>
                <p class="ccLeadField ccLeadEntryTerm">
                    <label for="EntryTerm-6559469661"><span class="screenreader">When do you want to start? *</span></label><select id="EntryTerm-6559469661" class="required ccLeadInputSelect chosen-select" name="EntryTerm" data-placeholder="When do you want to start? *" title="Entry Term" data-msg-required="Please select your desired entry term."><option value="">When do you want to start? *</option></select></p>
                <p class="ccLeadSubmit">
                    <input type="submit" title="Request More Information" class="ccLeadButton" value="Submit">
                    <span class="ccLeadPersonalInfo">
                        Champlain College will not share or sell personal information.
                    </span>
                </p>
                <div style="margin:0;padding:0;height:1px;clear:both;"></div>
            </form>
        </div>
    </div>
</script>
<script type="text/template" id="cclead-6559469661-thankyou-template">
    <div class="ccLeadThanks"><h2>Thank you for your interest!</h2>
        <p>Keep an eye on your mail, we'll be sending you info and a gift soon.</p></div>
</script>

<!-- Global configuration for lead forms -->
<script>
    var CCLEAD = {};

    // Customizations.  See documentation at bottom of formbuilder for info.
    CCLEAD.customizations = CCLEAD.customizations || {}

    CCLEAD.customizations['cclead-6559469661'] = [ function($form, options) {
        options.ignore = ':hidden:not(.chosen-select)';
        // Note that the error placement may need to change based on your form layout
        options.errorPlacement = function(error, element){
            error.appendTo(element.parent('p'));
        };

        /**
         * Grab our undergrad programs and use them in place of the
         * hardcoded list. First look in local storage for the
         * program finder information, we can pull from that.
         *
         */
        function fetch_programs() {

            var data = null;
            // Ensure we've got modernizr
            if(window.Modernizr) {
                // Now see if we have local storage
                // Check localStorage for programfinder data before attempting to load from server
                if (Modernizr.localstorage && localStorage.getItem('programfinder') !== null) {

                    var storedData = $.parseJSON(localStorage.getItem('programfinder'));

                    // Make sure data is not expired
                    var oneDay = 1000 * 60 * 60 * 1, // one day in milliseconds
                        now = new Date().getTime();

                    if (storedData.date && now - storedData.date < oneDay) {
                        data = storedData.records;
                        handle_programs(data);
                    }
                }

                // Grab data from programfinder API if failed to get from localStorage
                if (!data) {

                    var xhr = $.ajax({
                        url: 'https://forms.champlain.edu/googlespreadsheet/find/type/programfinder',
                        jsonp: 'callback',
                        dataType: 'jsonp',
                        data: {
                            format: 'json'
                        }
                    });

                    xhr.done(function(serverData, textStatus, jqXHR) {

                        if (serverData.status !== 'SUCCESS' || !serverData.message) {
                            console.log('failed due to application level error.');
                            return;
                        }

                        var storedData = {
                            records: serverData.message,
                            date: new Date().getTime()
                        };

                        if (Modernizr.localstorage && JSON && JSON.stringify) {
                            localStorage.setItem('programfinder', JSON.stringify(storedData));
                        }

                        data = storedData.records;

                        handle_programs(data);

                    });

                    xhr.fail(function(jqXHR, textStatus, errorThrown) {
                        console.log('failed due to server level error.');
                        console.log(textStatus);
                        console.log(errorThrown);
                    });
                }
            }
        }

        /**
         * Handle the programs list we have, update our select list.
         *
         *
         */
        function handle_programs(programs) {
            // Set up our program filters, we don't want everything coming through
            var program_regex = /(?:\(minor\))|(?:double major)|(?:combined)/i,
                filtered_programs = [],
                valid_programs = [],
                processed_programs = [], // Needed because programs show up multiple times in our listings
                desired_audience = 'Undergraduate Programs (on-campus)',
                min_program_count = 10,
                program_select_id = 'Major-6559469661',
                $major_select = $('#'+program_select_id);

            filtered_programs.push('Computer & Digital Forensics (Combined BS/MS)');

            try {
                $.each(programs, function (key, val) {
                    // Ensure it's actually program finder data
                    if(val.type === 'programfinder') {
                        // Ensure we havent processed this program already
                        if(processed_programs.indexOf(val.admissions_career_goal) === -1) {
                            // Ensure it's audience is actually undergrad
                            if(val.audience == desired_audience) {
                                // Ensure it's not a filtered program
                                if(filtered_programs.indexOf(val.program) === -1) {
                                    // Now check our regex
                                    if(!program_regex.test(val.program)) {
                                        // This is a valid undergrad program
                                        valid_programs.push({
                                            name: val.program,
                                            weight:val.weight,
                                            datatel_id: val.admissions_career_goal,
                                            url: val["website_(just_use_extension)"]
                                        });
                                        processed_programs.push(val.admissions_career_goal);
                                    }
                                }
                            }
                        }
                    }
                });

                // If we have enough valid programs
                if(valid_programs.length > min_program_count) {
                    // Sort by weight
                    valid_programs.sort(function(a,b) {
                        if(a.name > b.name) {
                            return 1;
                        }
                        if(a.name < b.name) {
                            return -1;
                        }
                        return 0;
                    });

                    // Now prep to replace our program dropdown
                    var program_html = '<option>What do you want to study? *</option>';

                    var currentUrl = document.location.pathname;

                    var foundProgram = false;

                    $.each(valid_programs, function(k,v){
                        if(!foundProgram) {
                            // See if this program is the current page we are on based on URL
                            var programUrl = v.url;
                            programUrl = programUrl.replace(/[-\/\\^$*+?.()|[\]{}]/g, '\\$&');
                            var programUrlPattern = new RegExp('' + programUrl + '(?:.*)?');
                            if(programUrlPattern.test(currentUrl)) {
                                program_html += '<option value="' + v.datatel_id + '" selected="selected">' + v.name + '</option>';
                                foundProgram = true;
                            } else{
                                program_html += '<option value="' + v.datatel_id + '">' + v.name + '</option>';
                            }
                        }
                        else{
                            program_html += '<option value="' + v.datatel_id + '">' + v.name + '</option>';
                        }
                    });

                    // Now add static undecided options
                    program_html += get_undecided_programs();

                    // Now empty out our static program list and add this one
                    $major_select.empty().append(program_html);

                    // Enable chosen
                    $major_select.trigger('chosen:updated').trigger('chosen:buildresultslist');

                }
            }
            catch(e) {
                console.log(e);
            }
        }

        /**
         * Helper to hold static undecided programs for listing
         *
         */
        function get_undecided_programs() {
            return '<option value="BCCM">Undeclared: Communication &amp; Creative Media</option><option value="BEHS">Undeclared: Education &amp; Human Studies</option><option value="BITS">Undeclared: Information Technology &amp; Sciences</option><option value="BBUS">Undeclared: Robert P. Stiller School of Business</option>';
        }

        function get_enrollment_periods() {
            var enrollmentPeriods = [];

            // Spring period
            enrollmentPeriods.push({
                label: 'Spring',
                datatel_label: 'SP',
                //cut_off: 'January 4th'
                cut_off: '01/04',
                month: 'January'
            });

            // Fall period
            enrollmentPeriods.push({
                label: 'Fall',
                datatel_label: 'FA',
                // cut_off: 'August 24th'
                cut_off: '08/24',
                month: 'August'
            });

            return enrollmentPeriods;
        }

        /**
         *
         *
         */
        function build_semesters() {
            var yearsToBuild = 5,
                enrollmentPeriods = get_enrollment_periods(),
                semesterHtml = '',
                semeseterSelectId = 'EntryTerm-6559469661';

            // set our dates up
            var currentDate = new Date(),
                lastDate = new Date(),
                now = new Date();

            // Set the last year we will build to
            lastDate.setFullYear(lastDate.getFullYear() + yearsToBuild);

            // Now start building out our years
            do {
                var currentYear = currentDate.getFullYear();

                var haveOneOption = false;
                var optionsHtml = '';
                // Loop through our enrollment periods
                for(var i = 0; i<enrollmentPeriods.length;i++) {
                    // Ensure the enrollment period for this year hasn't passed
                    var cutOffDate = new Date(currentYear + '/' + enrollmentPeriods[i].cut_off);
                    // If the cutoff date is in the future, add this option to our list
                    if(now < cutOffDate) {
                        haveOneOption = true;
                        optionsHtml += '<option value="' + currentYear + enrollmentPeriods[i].datatel_label + '">' + enrollmentPeriods[i].label + ' ' + currentYear + ' (' + enrollmentPeriods[i].month + ')</option>';
                    }
                }
                if(haveOneOption) {
                    semesterHtml += '<optgroup label="' + currentYear + '">';
                    semesterHtml += optionsHtml;
                    semesterHtml += '</optgroup>';
                }

                currentDate.setFullYear(currentDate.getFullYear() + 1);
            } while(currentDate<lastDate);

            // Now that we have our semesters, add it to the form
            $('#' + semeseterSelectId).append(semesterHtml);
        }

        // Now fill our program select list
        fetch_programs();

        // Generate our semesters of interest options
        build_semesters();


        $('.chosen-select').chosen({search_contains: true});
        return options;
    }];



    // Array of forms on page along with their configurations.
    CCLEAD.forms = CCLEAD.forms || {};
    CCLEAD.forms["cclead-6559469661"] = {
        postingUrl: "https://forms.champlain.edu/salesforce/lead",
        cssUrl: "https://forms.champlain.edu/secure/cclead/cclead-undergrad-generic-theme.css",
        formType: "requestinfoug",
        locationBefore: "#sidebar > div",
        mobileLocationAfter: ".userMarkup:last"
    };
</script>

<!-- Render lead forms -->
<script src="https://forms.champlain.edu/secure/cclead/cclead3.js"></script>

<script src="https://4207a4034b66fcac6710-e3309a66dbe1bbd0a933cac4265f90e8.ssl.cf2.rackcdn.com/chosen/cc-chosen.jquery.js?v=1"></script>